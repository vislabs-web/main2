<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Face‑Capture Camera</title>
  <style>
    :root {
      --bg: #111;
      --panel: #1e1e1e;
      --accent: #4ade80;
      --danger: #ef4444;
    }
    *{box-sizing:border-box}
    body{
      margin:0;height:100vh;display:flex;justify-content:center;align-items:center;
      background:var(--bg);color:#fff;font-family:system-ui,Arial,sans-serif
    }
    .container{position:relative}
    video,canvas{
      border:4px solid var(--panel);border-radius:1rem;max-width:90vw;height:auto
    }
    #overlay{position:absolute;top:0;left:0;pointer-events:none}
    #indicator{
      position:absolute;top:1rem;left:1rem;padding:.3rem .8rem;border-radius:.5rem;
      background:var(--panel);font-weight:600;transition:background .2s ease
    }
    #indicator.face{background:var(--accent)}
    #indicator.noface{background:var(--danger)}
    #errorMsg{
      position:fixed;bottom:1rem;left:50%;transform:translateX(-50%);max-width:90vw;
      background:#ef4444aa;padding:.5rem 1rem;border-radius:.5rem;display:none
    }
  </style>
</head>
<body>
  <div class="container">
    <video id="video" playsinline muted></video>
    <canvas id="overlay"></canvas>
    <span id="indicator" class="noface">No Face</span>
  </div>
  <div id="errorMsg"></div>

  <script>
    const video = document.getElementById('video');
    const overlay = document.getElementById('overlay');
    const indicator = document.getElementById('indicator');
    const errorMsg = document.getElementById('errorMsg');

    let WIDTH = 320, HEIGHT = 240;
    const overlayCtx = overlay.getContext('2d');

    // Use built‑in Shape Detection API if available
    const faceDetector = ('FaceDetector' in window) ? new FaceDetector({ fastMode: true }) : null;

    async function startCamera(){
      try{
        const stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: 'user' } });
        video.srcObject = stream;
        await video.play();
        resizeCanvases();
        if(!faceDetector){
          showError('FaceDetector API not supported in this browser. Try Chrome/Edge on desktop or Android ≥ 109.');
          return;
        }
        requestAnimationFrame(tick);
      }catch(err){
        showError('Camera access error: '+err.message+'\nTip: serve via https:// or localhost, not file://');
      }
    }

    function resizeCanvases(){
      WIDTH = video.videoWidth || WIDTH;
      HEIGHT = video.videoHeight || HEIGHT;
      overlay.width = WIDTH;
      overlay.height = HEIGHT;
      video.style.width = overlay.style.width = WIDTH + 'px';
      video.style.height = overlay.style.height = HEIGHT + 'px';
    }

    function showError(msg){
      errorMsg.textContent = msg;
      errorMsg.style.display = 'block';
    }

    async function tick(){
      if(video.readyState === video.HAVE_ENOUGH_DATA){
        try{
          const faces = await faceDetector.detect(video);
          overlayCtx.clearRect(0,0,WIDTH,HEIGHT);
          if(faces.length){
            indicator.textContent = 'Face Detected';
            indicator.classList.add('face');
            indicator.classList.remove('noface');
            overlayCtx.strokeStyle = 'lime';
            overlayCtx.lineWidth = 3;
            faces.forEach(face => {
              const { x, y, width, height } = face.boundingBox;
              overlayCtx.strokeRect(x, y, width, height);
            });
          }else{
            indicator.textContent = 'No Face';
            indicator.classList.add('noface');
            indicator.classList.remove('face');
          }
        }catch(err){
          console.error(err);
        }
      }
      requestAnimationFrame(tick);
    }

    window.addEventListener('DOMContentLoaded', startCamera);
  </script>
</body>
</html>
